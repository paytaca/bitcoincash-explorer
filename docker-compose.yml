version: "3.9"

services:
  web:
    build:
      context: .
      dockerfile: Dockerfile
    # Host networking lets the container reach host-local services bound to 127.0.0.1
    # (e.g. BCHN RPC at http://127.0.0.1:8332/) without changing BCHN config.
    network_mode: "host"
    environment:
      # Nuxt/Nitro server
      NITRO_HOST: "0.0.0.0"
      NITRO_PORT: "8000"

      # Map our existing .env keys into Nuxt runtime config env vars.
      # (Nuxt reads NUXT_* variables at runtime; it does NOT read BCH_RPC_URL directly in production.)
      NUXT_BCH_RPC_URL: ${BCH_RPC_URL}
      NUXT_BCH_RPC_USER: ${BCH_RPC_USER}
      NUXT_BCH_RPC_PASS: ${BCH_RPC_PASS}
      NUXT_BCMR_BASE_URL: ${BCMR_BASE_URL:-https://bcmr.paytaca.com}
      NUXT_FULCRUM_HOST: ${FULCRUM_HOST:-127.0.0.1}
      NUXT_FULCRUM_PORT: ${FULCRUM_PORT:-60001}
      NUXT_FULCRUM_TIMEOUT_MS: ${FULCRUM_TIMEOUT_MS:-10000}
      NUXT_PUBLIC_CHAIN: ${CHAIN:-mainnet}
    # Keep secrets/config on the server, not in git.
    env_file:
      - .env
    restart: unless-stopped
